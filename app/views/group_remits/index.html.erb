<%= content_tag :h3, "List of Remitances" %>


<div class="mb-3">
  <%= link_to new_group_remit_path, class: 'btn btn-sm btn-primary' do %>
    New Group Remit
  <% end %>
</div>

<div class="table-responsive">
  <table class="table table-striped table-bordered table-hover">
    <thead>
      <tr> 

        <th>ID</th>
        <th>Name</th>
        <th>Effectivity Date</th>
        <th>Expiry Date</th>
        <th>Total Premium</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody>
      <% @group_remits.each do |group_remit| %>
        <tr>
        <% batches = group_remit.batches %>
        <% batches_dependents= BatchDependent.joins(batch: :group_remit)
                                 .where(group_remits: {id: group_remit.id}) %>
        <% batches_premium = batches.sum(:premium) %>
        <% batch_dependent_premiums = batches_dependents.sum('batch_dependents.premium') %>
        <% gross_premium = batches_premium + batch_dependent_premiums %>
        <td><%= group_remit.id %></td>
        <td><%= group_remit.name %></td>
        <td><%= group_remit.effectivity_date.strftime('%B %d, %Y') %></td>
        <td><%= group_remit.expiry_date.strftime('%B %d, %Y') %></td>
        <td><%= number_to_currency(gross_premium , unit: "â‚±", precision: 2) %></td>
    
          <td>
            <%= link_to 'View', group_remit, class: 'btn btn-sm btn-primary' %>
            <%= link_to 'Edit', edit_group_remit_path(group_remit), class: 'btn btn-sm btn-secondary' %>
          </td>

        </tr>
      <% end %>
    </tbody>
  </table>
</div>
