<%= content_tag :h3, 'Insurance Plans' %>
<div class="row row-cols-2 row-cols-md-2 g-4 mb-3">
	<% @agreements.each do |agreement| %>
		<% group_remit = agreement.group_remits.last %>
    <% gr_presenter = GroupRemitPresenter.new(group_remit) %>
		<% batch = group_remit.batches.find_by(coop_member_id: @coop_member.id) %>
		<% benefit = batch.agreement_benefit %>
		<div class="col">
			<div class="card">
				<div class="card-body">
					<div class="d-flex gap-2 align-items-center">
						<h5 class="card-title" style= "width: 100%">
							<div class="<%= flex_justify_align('between', 'center') %>">
								<div class="">
									<%= agreement.plan.name %>
									<%= content_tag :span, gr_presenter.status_text, class: gr_presenter.status_badge %>
								</div>
								<div class="">
									<%= link_to 'View Insurance', group_remit_path(group_remit), class: small_btn('warning text-dark') %>
									<%= link_to 'File Claim', group_remit_path(group_remit), class: small_btn('primary') %>
								</div>
							</div>
						</h5>
					</div>
					<%= content_tag :p, agreement.moa_no, class: "card-text text-secondary" %>
					<%= content_tag :span, @coop_member.full_name.titleize, class: 'text-primary', style: 'font-size: 1.2rem; font-weight: bold' %>
					<%= content_tag :span, "- #{benefit.insured_type.to_s.titleize}", class: 'text-muted' %>
					<table class="table table-borderless table-hover">
						<thead>
							<tr>
								<th class="text-primary">Benefits</th>
								<th class="text-primary text-end">Amount</th>
							</tr>
						</thead>
						<tbody>
							<% benefit.product_benefits.includes(:benefit).each do |product| %>
								<tr>
									<td><small><%= product.benefit.name %></small></td>
									<td class="text-end"><%= peso_currency(product.coverage_amount) %></td>
								</tr>
							<% end %>
						</tbody>
						<tfoot class="fw-bold border-top border-primary mb-3">
							<td colspan='2'>Total</td>
							<td class="text-end"><%= peso_currency(benefit.product_benefits.sum(:coverage_amount)) %></td>
						</tfoot>
					</table>

					<% if agreement.plan.gyrt_type == 'family' %>
						<% batch.batch_dependents.includes(:member_dependent, :agreement_benefit).each do |dependent| %>
							<%= content_tag :span, dependent.member_dependent.full_name.titleize, class: 'text-primary', style: 'font-size: 1.2rem; font-weight: bold' %>
							<%= content_tag :span, "- #{dependent.agreement_benefit.insured_type.to_s.titleize}", class: 'text-muted' %>
							<table class="table table-borderless table-hover">
								<thead>
									<tr>
										<th class="text-primary">Benefits</th>
										<th class="text-primary text-end">Amount</th>
									</tr>
								</thead>
								<tbody>
									<% benefit = dependent.agreement_benefit %>
									<% benefit.product_benefits.includes(:benefit).each do |product| %>
										<tr>
											<td><small><%= product.benefit.name %></small></td>
											<td class="text-end"><%= peso_currency(product.coverage_amount) %></td>
										</tr>
									<% end %>
								</tbody>
								<tfoot class="fw-bold border-top border-primary mb-3">
									<td colspan='2'>Total</td>
									<td class="text-end"><%= peso_currency(benefit.product_benefits.sum(:coverage_amount)) %></td>
								</tfoot>
							</table>
						<% end %>
					<% end %>
				</div>
			</div>
		</div>
	<% end %>
</div>


