<!-- New Member form Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-xl">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="staticBackdropLabel">Enroll New Member</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <%= render "members/form", member: @member%>
      </div>
    </div>
  </div>
</div>


<!-- Button trigger for New Member Enrollment -->
<div class="mb-1">
  <%= content_tag :button, "Enroll Member", 
    class: "btn btn-sm btn-success", 
    data: {bs_toggle: "modal",
      bs_target: "#staticBackdrop"
    }%>
</div>

<div class="d-flex justify-content-between align-items-end">
  <%= form_with url: import_members_path, method: :post do |form| %>
    <%= form.label :file, "For multiple enrollment upload your csv file.", class: "form-text" %>
    <div class="d-flex gap-3">
      <%= form.file_field :file, accept: ".csv", class: "form-control", style: "width: 80%" %>
      <%= submit_tag 'Upload', class: "btn btn-sm btn-success"%>
    </div>
  <% end %>

  <%= form_with url: coop_members_path, method: :get do %>
    <div class="form-group d-flex gap-3">
      <%= text_field_tag 'first_name_filter', nil, placeholder: 'First name', class: "form-control", style: "width: auto"%>
      <%= text_field_tag 'last_name_filter', nil, placeholder: 'Last name', class: "form-control", style: "width: auto"%>
      <%= submit_tag 'Filter', class: "btn btn-sm btn-success"%>
    </div>
  <% end %>
</div>


<div class="table-responsive mt-3">
  <table class="table table-striped table-bordered table-hover">
    <thead>
      <tr>

        <th>ID</th>
        <%# <th>Coop Branch</th> %>
        <th>Last Name</th>
        <th>First Name</th>
        <th>Middle Name</th>
        <th>Age</th>
        <th>Birthdate</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody>
      <% @filtered_members.each do |member| %>
        <tr>
        <%# <% member = coop_member.member %> 
        <%# <td><%= member.id %>
        <%# <td><%= member.coop_members.branch.name %>
        <% coop_member = member.coop_members.find_by(cooperative_id: @cooperative.id) %>
        <td><%= coop_member.id %></td>
        <td><%= member.last_name %></td>
        <td><%= member.first_name %></td>
        <td><%= member.middle_name %></td>
        <td><%= Date.today.year - member.birth_date.year - ((Date.today.month > member.birth_date.month || (Date.today.month == member.birth_date.month && Date.today.day >= member.birth_date.day)) ? 0 : 1) %></td>
        <td><%= member.birth_date.strftime('%B %d, %Y') %></td>
    
          <td>
            <%= link_to 'View', coop_member_path(coop_member.id), class: 'btn btn-sm btn-primary' %>
            <%= link_to 'Edit', edit_member_path(member), class: 'btn btn-sm btn-secondary' %>
          </td>

        </tr>
      <% end %>
    </tbody>
  </table>
</div>

<%== pagy_bootstrap_nav(@pagy) %>